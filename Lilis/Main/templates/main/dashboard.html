{% extends 'main/base.html' %}

{% block content %}
<h1 class="text-center mb-5 text-red fw-bold">Bienvenido al Panel de Control de Lilis üç¨</h1>

{% if messages %}
<div class="container mt-3">
    {% for message in messages %}
    <div class="alert alert-danger alert-{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="row g-4 text-center">
    <div class="col-md-3">
        <a href="{% url 'products_list' %}" class="text-decoration-none text-dark">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h2 class="text-red display-5 fw-bold">{{ productos }}</h2>
                    <p class="text-muted">Productos registrados</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'supplier_list' %}" class="text-decoration-none text-dark">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h2 class="text-red display-5 fw-bold">{{ proveedores_activos }} / {{ proveedores }}</h2>
                    <p class="text-muted">Proveedores activos</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'user_list' %}" class="text-decoration-none text-dark">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h2 class="text-red display-5 fw-bold">{{ usuarios }}</h2>
                    <p class="text-muted">Usuarios registrados</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'client_list_all' %}" class="text-decoration-none text-dark">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h2 class="text-red display-5 fw-bold">{{ clientes_activos }} / {{ clientes }}</h2>
                    <p class="text-muted">Clientes activos</p>
                </div>
            </div>
        </a>
    </div>
</div>

<div class="mt-5">
    <a href="{% url 'transaction_list' %}" class="text-decoration-none text-dark">
        <div class="card shadow-sm mb-3 p-2">
            <h2 class="text-muted">Transacciones recientes</h2>
            <table class="table table-striped align-middle">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Tipo</th>
                        <th>SKU</th>
                        <th>Cliente</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transacciones %}
                    <tr>
                        <td>{{ t.date }}</td>
                        {% if t.type == 'ingreso' or t.type == 'I' %}
                <td><span class="badge bg-success text-center">Ingreso</span></td>
            {% elif t.type == 'devolucion' %}
                <td><span class="badge bg-warning text-center">{{ t.type }}</span></td>
            {% elif t.type == 'transferencia' %}
                <td><span class="badge bg-warning text-center">{{ t.type }}</span></td>
            {% elif t.type == 'salida' %}
                <td><span class="badge bg-danger text-center">{{ t.type }}</span></td>
            {% else %}
                <td><span class="badge bg-info text-center">{{ t.type }}</span></td>
            {% endif %}
                        {% with d=t.details.first %}
                {% if d.batch %}
                    {% if d.batch.inventario.producto %}
                        <td>{{ d.batch.inventario.producto.sku|default_if_none:"No aplica." }}</td>
                    {% else %}
                        <td>{{ d.batch.inventario.materia_prima.sku|default_if_none:"No aplica." }}</td>
                    {% endif %}
                {% else %}
                    {% if d.serie.inventario.producto %}
                        <td>{{ d.serie.inventario.producto.sku|default_if_none:"No aplica." }}</td>
                    {% else %}
                        <td>{{ d.serie.inventario.materia_prima.sku|default_if_none:"No aplica." }}</td>
                    {% endif %}
                {% endif %}
            {% endwith %}
                        <td>{{ t.client.rut }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </a>
</div>

{% endblock content %}